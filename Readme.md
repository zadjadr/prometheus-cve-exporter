[![Test](https://github.com/zadjadr/prometheus-cve-exporter/actions/workflows/test.yaml/badge.svg)](https://github.com/zadjadr/prometheus-cve-exporter/actions/workflows/test.yaml) [![Release](https://github.com/zadjadr/prometheus-cve-exporter/actions/workflows/release.yaml/badge.svg)](https://github.com/zadjadr/prometheus-cve-exporter/actions/workflows/release.yaml)

# Prometheus CVE Exporter

Prometheus CVE Exporter is a Golang application that scans your system for all installed packages and compares them with the recent [NVD JSON feed](https://nvd.nist.gov/vuln/data-feeds#JSON_FEED). It exports metrics that provide insights into the security status of your packages.

## Features

- **Vulnerability Detection**: Identifies installed packages that have known vulnerabilities.
- **Prometheus Metrics**: Exports detailed metrics to Prometheus for monitoring and alerting.
- **Automated Updates**: Regularly fetches the latest NVD JSON feed to ensure up-to-date vulnerability information.

## Exported Metrics

| Metric Name                   | Type      | Description                                             | Labels                                      |
|-------------------------------|-----------|---------------------------------------------------------|---------------------------------------------|
| `nvd_vulnerable_packages`     | GaugeVec  | Indicates if a package is vulnerable (1) or not         | `package`, `version`, `cve`, `impact`       |
| `nvd_total_vulnerabilities`   | Gauge     | Total number of vulnerabilities detected                | None                                        |
| `nvd_last_update_time`        | Gauge     | Timestamp of the last successful update                 | None                                        |

## Building

### Prerequisites

- Go 1.22 or higher

### Steps

1. **Clone the repository**:

    ```sh
    git clone https://github.com/zadjadr/prometheus-cve-exporter.git
    cd prometheus-cve-exporter
    ```

2. **Build the application**:

    ```sh
    go build -o ./bin/ ./...
    ```

3. **Run the application**:

    ```sh
    ./bin/prometheus-cve-exporter -help
    ```

Alternatively, you can download the precompiled package from the releases section on GitHub.

## Usage

The Prometheus CVE Exporter will start a web server on port `10250` by default and expose the metrics at the `/metrics` endpoint.

To customize the settings, use the following flags:

```
  -config string
        path to config file
  -nvd-feed-url string
        URL for the NVD feed (default "https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-recent.json.gz")
  -port int
        Port to run the server on (default 10250)
  -severity string
        Comma separated list of severity levels for vulnerabilities (default "CRITICAL")
  -update-interval duration
        Update interval duration (default 24h0m0s)
```

Example:

```sh
./bin/prometheus-cve-exporter -port 9090 -severity "HIGH,CRITICAL" -update-interval 12h
```

Example with config file:

```json
{
  "nvd_feed_url": "https://nvd.nist.gov/feeds/json/cve/1.1/nvdcve-1.1-recent.json.gz",
  "update_interval": "12h",
  "port": 9090,
  "severity": [
    "HIGH",
    "CRITICAL"
  ]
}
```

```sh
./bin/prometheus-cve-exporter -config config.json
```
